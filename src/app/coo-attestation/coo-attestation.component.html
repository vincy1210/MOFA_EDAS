<div style="font-size: 12px !important; background-color: #ccc!important;">
  <div class="grid grid-cols-1" color="primary"  class="page-header">
               
    <label style="font-size: 14px; color: white; font-weight: bold;">{{'COO Attestation(s)' | translate}} - {{'Pending' | translate}}  </label>
  </div>
  
  <div style="padding:3px; border-radius:2px"  >
    <div class="grid grid-cols-1">
  
        <div class="grid grid-cols-1 lg:grid-cols-3">
          <div   
            [ngClass]="{'col-span-2': shouldShow, 'col-span-3': !shouldShow }" style="border-radius:5px; padding:5px; background-color: #fff;">
  
            <p-table
            [(selection)]="selectedAttestations" 
            [resizableColumns]="true"  dataKey="coorequestno" [rowSelectable]="isRowSelectable"
                         [scrollable]="false"  selectionMode="multiple"
                       #tableref [rowHover]="true" [paginator]="true"
                       currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                     
                       [totalRecords]="totalrecords"
                       [value]="cooAttestationLists"
                       [rows]="10"
                       [columns]="cols"
                       [showCurrentPageReport]="true"
                       [rowsPerPageOptions]="[10,20,50]"
                       [loading]="loading"
                       styleClass="p-datatable-customers p-datatable-gridlines"
                       currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                       [globalFilterFields]="[
                         'declarationumber',
                         'edasattestno',
                         'totalamount',
                         'declarationdate',
                         'attestreqdate',
                         'status',
                         ''
                       ]"
                       [lazy]="true" (onLazyLoad)="InitTable($event)" [loading]="loading"
            >
            <ng-template pTemplate="caption">
              <p-toolbar  >
                <ng-template pTemplate="left">
               
                    <div style="padding: 5px;" class="col-md-3 col-lg-3 col-sm-6">
                            <mat-form-field class="searchboxinput"  >
                              <mat-label><mat-icon style="font-size:larger;">{{'search' | translate}}</mat-icon> {{'Search keyword' | translate}}</mat-label>
                              <input  matInput type="text" (input)="tableref.filterGlobal($any($event.target).value, 'contains')" placeholder="{{'Search keyword' | translate}}">
                            </mat-form-field>
                 
                  </div>
                 
                </ng-template>
        
                <ng-template pTemplate="right">
  
                  <div  *ngIf="enableFilters" style="padding: 5px;" class="col-md-3 col-lg-3  col-md-6">
                    <mat-form-field class="filter_datepicker">
                      <mat-label>{{'Start Date' | translate}}</mat-label>
                      <input matInput [matDatepicker]="decDatepicker1" [max]="todayModel" [(ngModel)]="oneMonthAgo" placeholder="{{'From' | translate}}" name="createdatefrom"  />
                      <mat-datepicker-toggle matSuffix [for]="decDatepicker1"></mat-datepicker-toggle>
                      <mat-datepicker #decDatepicker1></mat-datepicker>
                    </mat-form-field>
            </div>
            <div  *ngIf="enableFilters" style="padding: 5px;" class="col-md-3 col-lg-3  col-sm-6">
              <mat-form-field class="filter_datepicker">
                <mat-label>{{'End Date' | translate}}</mat-label>
                <input matInput [matDatepicker]="decDatepicker2" [min]="oneMonthAgo" [max]="today" placeholder="{{'To' | translate}}" [(ngModel)]="todayModel" name="createdateto"  />
                <mat-datepicker-toggle matSuffix [for]="decDatepicker2"></mat-datepicker-toggle>
                <mat-datepicker #decDatepicker2></mat-datepicker>
              </mat-form-field>
            </div>
            <div *ngIf="enableFilters"style="padding: 5px;" class="col-md-3 col-lg-3">
              <button type="button" mat-flat-button color="primary" (click)="FilterInittable()" >{{'Apply' | translate}}</button>
            </div>
  
            <span style="padding: 10px;"></span>
                  <button type="button" pButton  pRipple  icon="pi pi-file-excel"  (click)="exportExcel()"  class="mr-2 grid-header-right-icon"  pTooltip="Excel"
                  tooltipPosition="bottom"
                ></button>
                 <button  type="button"
                  pButton  pRipple  icon="pi pi-filter"   (click)="clickChips()"  class="mr-2 grid-header-right-icon"
                  [ngClass]="{ clicked: enableFilters }"  [pTooltip]="'Filter' | translate"  tooltipPosition="bottom"
                ></button>
                </ng-template>
            </p-toolbar>
            </ng-template>
  
              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th style="width: 3rem">
                    <p-tableHeaderCheckbox (click)="loadsidepanel(cooAttestationLists)">
                    </p-tableHeaderCheckbox>
                  </th>
                  <th *ngFor="let col of columns" pResizableColumn [pSortableColumn]="col.field" [style.width]="col.width">
                    {{ col.header | translate }}
                    <p-sortIcon
                      field="code"
                    ></p-sortIcon>
                    <p-columnFilter
                      *ngIf="enableFilters"
                      type="text"
                      [field]="col.field"
                      display="menu"
                    ></p-columnFilter>
                  </th>
                  <th pFrozenColumn alignFrozen="right" >{{'Action'}}</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-data>
                <tr [ngClass]="{
                  'highlighted-row': data.isSelected,
                  'custom-text-color': data.isSelected,
                  'bold-text': data.isSelected
                }">
                  <td>
                    <p-tableCheckbox
                      (click)="loadsidepanel(data)"  [disabled]="isPaid(data)"
                      [value]="data"
                    ></p-tableCheckbox>
                  </td>
                  <!-- <td>
                   
                    <button pButton type="button" (click)="openNew_(data)">{{data.declarationumber}}</button>
 
                  </td> -->
                  <td class="hyperlink">
   

                    <button pButton type="button" (click)="openNew_(data)">{{data.declarationumber}}</button>
                 
                
                            </td>
                  <td>
                    <span class="image-text">{{ data.edasattestno }}</span>
                  </td>
                  <td>
                    <p-tag [value]="data.feespaid" [severity]="getSeverity(data.feespaid)"></p-tag>
                  </td>
                  <td style="text-align: right;">
                    <span class="image-text">{{ common.formatAmount(data.totalamount) }}</span>
                  </td>
                  <td>
                    <span class="image-text">{{
                      common.splitdatetime(data.declarationdate)?.date
                    }}</span>
                  </td>
                  <td>
                    <span class="image-text">{{
                      common.splitdatetime(data.attestreqdate)?.date
                    }}</span>
                  </td>
                
                  <td pFrozenColumn alignFrozen="right"  >
                    <span (click)="openNew(data)" style="padding:15px; cursor: pointer;" pTooltip="Details"  class="image-text viewaction">
                      <mat-icon class="action_eye_icon" >visibility</mat-icon>
                        </span>
  
                    <span *ngIf="data.feespaid === 'Paid'" (click)="uploadDeclaration(data)" style="padding:15px; cursor: pointer;" pTooltip="Upload attachment"  class="image-text viewaction">
                      <mat-icon class="action_eye_icon" >upload</mat-icon>
                        </span> &nbsp;
  </td>
  
  
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="8">{{ "noDataFound" | translate }}</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
          <div
            class="mofa-tab-section show mofa-tab-outer-mask "
            [ngClass]="{ show: shouldShow, hide: !shouldShow }" >
  
          <div class="ng_show_close_icon">
            <br>
            <span (click)="closesidetab()">
              <mat-icon  class="rounded-icon" style="color: white;" pTooltip="{{'close' | translate}}">chevron_right</mat-icon>
  
            </span>
            <br>
  
          </div>
            <!-- <app-attestation-workflow [selectedAttestations]="selectedAttestations"></app-attestation-workflow> -->
            <mat-tab-group>
              <mat-tab label="Timeline" *ngIf="Timelinevisible">
                <div class="grid grid-cols-1">
                  <div  class="dw-container mt-5">
                    <div *ngFor="let item of timelineItems; let i = index" class="timeline-block timeline-block-right {{ item.status }}">
                      <div class="marker"></div>
                      <div class="timeline-content">
                        <div class="float-left ml-3">
                          <div class="grid grid-cols-1">
                            <div class="w-100">
                              <mat-chip-list>
                                <h6 class="al-title">
                                  <span>{{item.title}}</span><mat-icon>check</mat-icon>
                                </h6>
                              </mat-chip-list>
                            </div>
                            <small
                              ><strong>{{ item.date }}</strong></small
                            >
                            <small>{{ item?.time }}</small>
                          </div>
                        </div>
                      </div>
                    </div>
           
            
                  
                  </div>
                </div>
              </mat-tab>
              <mat-tab label="Payment">
                <div class="flex grid grid-cols-2 gap-6 p-5 payment-header-label">
                  <div class="p-1"><mat-label class="payment-header-label">{{'No. of COO selected' | translate}}</mat-label></div>
                  <div class="amount_right_align">{{ noOfInvoicesSelected }}</div>
                  <!-- <div class="p-1"><mat-label class="payment-header-label">Total Fines(0)</mat-label></div>
                  <div class="amount_right_align">{{ totalFineAmount }}</div> -->
                  <div class="p-1"><mat-label class="payment-header-label">{{'Attestation Fees' | translate}}</mat-label></div>
                  <div class="amount_right_align">{{'AED' | translate}} {{ common.formatAmount(totalAttestationFee) }}</div>
                  <!-- nil -->
                  <div class="p-1"></div>
                  <div class="payment-total-amount">
                    <div class="row">
                      <span><mat-label class="amount_right_align payment-header-label">{{'Total Amount' | translate}}</mat-label></span>
                    </div>
                    <div class="row" style="padding: 5px;"></div>
  
                    <div class="row">
                      <span
                        ><mat-label class="payment-total-amount2 amount_right_align">{{'AED' | translate}} {{ common.formatAmount(totalFee) }}</mat-label></span
                      >
                    </div>
                    <div class="row" style="padding: 2px;"></div>
                    <div class="row">
                      <span><mat-label class="payment-total-amount3 amount_right_align">{{'incl.VAT' | translate}}</mat-label></span>
                    </div> 
                    <!-- {{payment_button_isdisabled}} -->
                  </div>
                
                  <div class="gap-4 flex items-center justify-center col-span-2">
                    <button [disabled]="payment_button_isdisabled"
                      mat-flat-button
                      color="primary"
                      (click)="AttestationPay()"
                      class="pay-btn"
                    >
                    {{payorpayall}}
                    </button>
                  </div>
                  <div class="flex items-center justify-center col-span-2">
                    <a class="powered_by" >{{'Powered by' | translate}}</a> &nbsp;<a class="magnati">{{'magnati' | translate}}</a>
                  </div>
                </div>
              </mat-tab>
              <!-- <mat-tab *ngIf="previewvisible" label="{{'Preview' | translate}}">
                <div class="grid grid-cols-1">
                  <div id="outerContainer">
                    <div class="pdf-container">
                      <pdf-viewer
                        [src]="src"
                        [rotation]="0"
                        [original-size]="false"
                        [show-all]="true"
                        [fit-to-page]="false"
                        [zoom]="1"
                        [zoom-scale]="'page-width'"
                        [stick-to-page]="false"
                        [render-text]="true"
                        [external-link-target]="'blank'"
                        [autoresize]="true"
                        [show-borders]="false"
                        style="width: 100%; height: 600px"
                      ></pdf-viewer>
                    </div>
                  </div>
                </div>
              </mat-tab> -->
            </mat-tab-group>
          </div>
        </div>
        <div
          class="bg-white rounded-lg p-5 mofa-tab-section show"
          [ngClass]="{ show: shouldShow, hide: !shouldShow }"
        >
          <!-- <app-attestation-workflow [selectedAttestations]="selectedAttestations"></app-attestation-workflow> -->
        </div>
      </div>
    </div>
    <br>
    
  
    
    <p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>
  
  
    <p-dialog [(visible)]="AddInvoiceDialog" [draggable]="false" style="top:20%" [style]="{ width: '750px' }" header="{{'COO Attestation Details' | translate}}" [modal]="true" styleClass="p-fluid">
      
 
<div class="viewmore">
    <div class="more-content-section">
      <div class="grid grid-cols-2">
        <ng-container >
         
          <div class="more-content" *ngFor="let field of fields">
            <mat-label class="title-label">{{ field.label | translate }}</mat-label>
            <div class="more-content-body">
              <mat-label class="more-content-block">{{ field.value }}</mat-label>
            </div>
          </div>
          
        </ng-container>
      </div>
    </div>
  </div>
  
 


      <ng-template pTemplate="footer">
        <p-button icon="pi pi-times" (click)="AddInvoiceDialog = false" label="{{'Cancel' | translate}}" styleClass="p-confirm-dialog-reject"></p-button>
    </ng-template>
  
  </p-dialog>


  <!-- modal 2 start -->

  <p-dialog [(visible)]="AddInvoiceDialog_" [draggable]="false" style="top:20%" [style]="{ width: '750px' }" header="{{'LCA Invoice(s) Details' | translate}}" [modal]="true" styleClass="p-fluid">
      
    <br>
    
    <p-table [(selection)]="selectedAttestations_LCA"  [resizableColumns]="true" dataKey="edasattestno"  [scrollable]="true"   selectionMode="multiple"
        #tableref [rowHover]="true" [paginator]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0"
        [totalRecords]="totalrecords_LCA"
        [value]="cooAttestationLists_LCA"
        [rows]="10" [columns]="cols_"
        [showCurrentPageReport]="true"
        [rowsPerPageOptions]="[10, 20, 50]"
        [loading]="loading"
        styleClass="p-datatable-customers p-datatable-gridlines"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [globalFilterFields]="[
          'edasattestno',
          'invoicenumber',
          'declarationumber',
          'declarationdate', 'attestreqdate', 'Noofdaysleft'
        ]" [lazy]="true"  (onLazyLoad)="InitTable($event)" [rowSelectable]="isRowSelectable" >
      
      
        
        <ng-template pTemplate="header" let-columns>
          <tr>
             
              <th *ngFor="let col of columns" pResizableColumn [pSortableColumn]="col.field" [style.width]="col.width" >
                  {{col.header}} <p-sortIcon field="code"  ></p-sortIcon>
                  <p-columnFilter
                  type="text"
                  [field]="col.field"  *ngIf="enableFilters" 
                  display="menu"
                ></p-columnFilter>
              </th>
              <!-- <th pFrozenColumn alignFrozen="right">{{'Action' | translate}}</th> -->
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-customer let-columns="columns" >
          <tr [ngClass]="{
            'highlighted-row custom-text-color bold-text': customer.isSelected }" >
            <!-- ,
            'coonotpaidclass': isCOONotPaid(customer) -->
              <td><p-tableCheckbox  pTooltip="{{ isCOONotPaid(customer) ? 'COO payment is not done' : '' | translate }}" (click)="loadsidepanel(customer)" [disabled]="isCOONotPaid(customer)" [value]="customer"></p-tableCheckbox> </td>
            <!-- <td><span class="image-text">{{customer.edasattestno}} </span></td> -->
            <td class="hyperlink">
   

    <button pButton type="button" (click)="openNew_(customer)">{{customer.edasattestno}}</button>
 

            </td>

            <td><span class="image-text">{{customer.companyname}}</span></td>
            <td style="text-align: right;"><span class="image-text">{{common.formatAmount(customer.invoiceamount)}}</span></td>
            <td style="text-align: right;"><span class="image-text">{{common.formatAmount(customer.feesamount)}}</span></td>

            <td><span class="image-text">{{customer.invoiceid}}</span></td>
            <td><span class="image-text">{{customer.declarationumber}}</span></td>
            <td><span class="image-text">{{common.splitdatetime(customer.declarationdate)?.date}}</span></td>
            <td><span class="image-text">{{common.splitdatetime(customer.attestreqdate)?.date}}</span></td>
            <td>
              <span class="image-text">{{customer.lcaname}}</span>
            </td>

            <td>
              <p-tag [value]="customer.canpay === 1 ? 'COO paid' : 'COO unpaid'" [severity]="getSeverity_(customer.canpay)"></p-tag>
            </td>

            <td><span class="image-text">{{customer.noofdaysoverdue}}</span></td>
            
          </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="12">{{'No data found.' | translate}}</td>
          </tr>
        </ng-template>
      </p-table>
   
         <ng-template pTemplate="footer">
           <p-button icon="pi pi-times" (click)="AddInvoiceDialog_ = false" label="{{'Cancel' | translate}}" styleClass="p-confirm-dialog-reject"></p-button>
       </ng-template>
     
     </p-dialog>


  <!-- modal 2 end -->
  
  
  
  
    
    